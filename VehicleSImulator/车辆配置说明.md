# 车辆配置说明文档

## 概述

增强车辆模拟器使用JSON配置文件来定义每辆车的个性化参数，支持真实的物理模拟和智能行为。

## 配置文件结构

### 主配置文件格式

```json
{
  "vehicles": [
    {
      "id": "vehicle_001",
      "licensePlate": "YRN·03V",
      "carModel": "Tesla Model S",
      // ... 其他配置项
    }
  ]
}
```

## 配置参数详解

### 基本信息 (Basic Information)

| 参数 | 类型 | 必需 | 说明 | 示例 |
|------|------|------|------|------|
| `id` | string | ✓ | 车辆唯一标识符 | "vehicle_001" |
| `licensePlate` | string | ✓ | 车牌号 | "YRN·03V" |
| `carModel` | string | ✓ | 车型名称 | "Tesla Model S" |
| `energyType` | string | ✓ | 能源类型 | "Electric", "Hybrid", "Gasoline" |
| `year` | integer | ✓ | 生产年份 | 2023 |

### 车辆尺寸 (Dimensions)

```json
"dimensions": {
  "length": 5,    // 长度(米)
  "width": 2,     // 宽度(米)  
  "height": 1     // 高度(米)
}
```

### 设备信息 (Equipment)

```json
"equipment": {
  "radarModel": "Tesla Autopilot Radar",  // 雷达型号
  "radarCount": 8,                        // 雷达数量
  "cameraModel": "Tesla Vision Camera",   // 摄像头型号
  "cameraCount": 8                        // 摄像头数量
}
```

### 初始位置 (Initial Position)

```json
"initialPosition": {
  "longitude": 116.397428,           // 经度 (-180 到 180)
  "latitude": 39.90923,              // 纬度 (-90 到 90)
  "description": "北京市中心"         // 位置描述
}
```

**重要说明：**
- 经度范围：-180 到 180
- 纬度范围：-90 到 90
- 车辆会在此位置周围的指定半径内移动

### 移动配置 (Movement Configuration)

```json
"movementConfig": {
  "maxSpeed": 120,                    // 最大速度 (km/h)
  "acceleration": 3.5,                // 加速度 (km/h/s)
  "deceleration": 4.0,                // 减速度 (km/h/s)
  "movementRadius": 0.01,             // 移动半径 (度)
  "speedVariation": 15,               // 速度变化范围 (km/h)
  "directionChangeInterval": 30       // 方向改变间隔 (秒)
}
```

**参数说明：**
- `maxSpeed`: 车辆能达到的最高速度
- `acceleration`: 加速时的速度增长率
- `deceleration`: 减速时的速度减少率
- `movementRadius`: 车辆围绕初始位置的活动半径
- `speedVariation`: 基于首选速度的随机变化范围
- `directionChangeInterval`: 多久改变一次移动方向

### 能源配置 (Energy Configuration)

```json
"energyConfig": {
  "maxEnergy": 100,                   // 最大电量 (%)
  "initialEnergy": 85,                // 初始电量 (%)
  "consumptionRate": 0.8,             // 消耗率 (%/分钟)
  "chargingRate": 15.0,               // 充电速率 (%/分钟)
  "autoChargeThreshold": 10,          // 自动充电阈值 (%)
  "chargingEfficiency": 0.95          // 充电效率 (0-1)
}
```

**能源管理逻辑：**
1. 车辆行驶时按 `consumptionRate` 消耗电量
2. 消耗率会根据速度和加速度动态调整
3. 当电量降至 `autoChargeThreshold` 时自动开始充电
4. 充电时车辆停止移动
5. 充电至95%时自动停止充电

### 传感器范围 (Sensor Ranges)

```json
"sensorRanges": {
  "engineRPM": [0, 0],                // 发动机转速 (电动车为0)
  "lubeOilPressure": [0, 0],          // 机油压力 (电动车为0)
  "fuelPressure": [0, 0],             // 燃油压力 (电动车为0)
  "coolantPressure": [10, 30],        // 冷却液压力
  "lubeOilTemp": [20, 40],            // 机油温度
  "coolantTemp": [60, 80],            // 冷却液温度
  "engineCondition": [90, 100]        // 引擎状况
}
```

**传感器数据生成规则：**
- 每个传感器在指定范围内生成随机值
- 数值会根据车辆状态动态调整（速度、电量等）
- 电动车的发动机相关传感器通常设为 [0, 0]

### 驾驶行为 (Driving Behavior)

```json
"drivingBehavior": {
  "aggressiveness": 0.3,              // 驾驶激进程度 (0-1)
  "preferredSpeed": 60,               // 首选速度 (km/h)
  "restProbability": 0.1,             // 休息概率 (0-1)
  "restDuration": [10, 30]            // 休息时长范围 (秒)
}
```

**行为影响：**
- `aggressiveness`: 影响加速和减速的激进程度
- `preferredSpeed`: 车辆倾向于保持的速度
- `restProbability`: 每分钟停下休息的概率
- `restDuration`: 休息时的停留时间范围

## 配置示例

### 高性能电动跑车

```json
{
  "id": "sports_car_001",
  "licensePlate": "FAST-01",
  "carModel": "Tesla Model S Plaid",
  "energyType": "Electric",
  "year": 2024,
  "movementConfig": {
    "maxSpeed": 200,
    "acceleration": 5.0,
    "deceleration": 6.0,
    "movementRadius": 0.015,
    "speedVariation": 20,
    "directionChangeInterval": 20
  },
  "energyConfig": {
    "maxEnergy": 100,
    "initialEnergy": 95,
    "consumptionRate": 1.2,
    "chargingRate": 20.0,
    "autoChargeThreshold": 15,
    "chargingEfficiency": 0.97
  },
  "drivingBehavior": {
    "aggressiveness": 0.8,
    "preferredSpeed": 80,
    "restProbability": 0.05,
    "restDuration": [5, 15]
  }
}
```

### 经济型家用车

```json
{
  "id": "family_car_001",
  "licensePlate": "ECO-01",
  "carModel": "BYD Qin Plus",
  "energyType": "Hybrid",
  "year": 2024,
  "movementConfig": {
    "maxSpeed": 120,
    "acceleration": 2.0,
    "deceleration": 2.5,
    "movementRadius": 0.008,
    "speedVariation": 10,
    "directionChangeInterval": 60
  },
  "energyConfig": {
    "maxEnergy": 100,
    "initialEnergy": 80,
    "consumptionRate": 0.5,
    "chargingRate": 8.0,
    "autoChargeThreshold": 20,
    "chargingEfficiency": 0.88
  },
  "drivingBehavior": {
    "aggressiveness": 0.2,
    "preferredSpeed": 50,
    "restProbability": 0.15,
    "restDuration": [20, 60]
  }
}
```

## 配置文件管理

### 创建配置文件

```bash
# 创建示例配置文件
python enhanced_main.py config

# 或者使用配置管理器
python -c "from vehicle_config_loader import VehicleConfigLoader; VehicleConfigLoader().save_config_template()"
```

### 验证配置文件

```bash
# 验证配置文件有效性
python enhanced_main.py config
```

### 重新加载配置

在交互模式中，停止模拟器后可以重新加载配置：
1. 输入 `stop` 停止模拟
2. 编辑配置文件
3. 输入 `start` 重新启动（自动加载新配置）

## 最佳实践

### 1. 位置配置
- 选择合适的初始位置和移动半径
- 避免车辆移动范围重叠过多
- 考虑真实地理环境

### 2. 能源管理
- 根据车型设置合理的消耗率和充电速率
- 电动车的充电阈值建议设置为10-20%
- 充电效率通常在85-98%之间

### 3. 驾驶行为
- 激进程度影响加速性能和能耗
- 首选速度应符合车型特性
- 休息概率模拟真实驾驶习惯

### 4. 传感器数据
- 电动车的引擎相关传感器设为0
- 温度和压力范围应符合实际情况
- 引擎状况反映车辆健康状态

## 常见问题

### Q: 车辆不移动怎么办？
A: 检查以下配置：
- `maxSpeed` 是否大于0
- `initialEnergy` 是否大于 `autoChargeThreshold`
- `acceleration` 是否大于0

### Q: 车辆一直在充电？
A: 可能的原因：
- `consumptionRate` 过高
- `chargingRate` 过低
- `autoChargeThreshold` 设置过高

### Q: 如何让车辆更激进/保守？
A: 调整 `drivingBehavior.aggressiveness` 参数：
- 0.0-0.3: 保守驾驶
- 0.4-0.6: 正常驾驶  
- 0.7-1.0: 激进驾驶

### Q: 配置文件格式错误？
A: 使用JSON验证工具检查：
- 确保所有字符串用双引号
- 检查逗号和括号匹配
- 使用配置验证功能

## 技术支持

如需帮助，请：
1. 使用 `--debug` 参数查看详细日志
2. 运行配置验证检查错误
3. 参考示例配置文件
4. 查看程序日志文件 